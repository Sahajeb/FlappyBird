<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flappy Combat â€“ Mobile</title>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  height:100%;
  overflow:hidden;
  background:#0f172a;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* GAME WRAPPER */
#game-container{
  position:relative;
  width:100%;
  max-width:420px;
  aspect-ratio:2/3;
  background:#70c5ce;
  border-radius:12px;
  overflow:hidden;
}

/* CANVAS */
canvas{
  width:100%;
  height:100%;
  display:block;
}

/* UI */
.ui{
  position:absolute;
  z-index:10;
  color:#fff;
  font-weight:bold;
}

#score{top:10px;right:10px;font-size:20px}
#level{top:36px;right:10px;font-size:16px}

#imageInput{
  top:10px;
  left:10px;
  font-size:12px;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}

#startBtn,#restartBtn{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#22c55e;
  color:#fff;
}

#restartBtn{top:58%}

#shootBtn{
  position:absolute;
  bottom:14px;
  right:14px;
  background:#ef4444;
  color:#fff;
}
</style>
</head>

<body>

<div id="game-container">
  <canvas id="game"></canvas>

  <input id="imageInput" class="ui" type="file" accept="image/*">
  <div id="score" class="ui">Score: 0</div>
  <div id="level" class="ui">Level: 1</div>

  <button id="startBtn">START</button>
  <button id="restartBtn" style="display:none">RESTART</button>
  <button id="shootBtn">ðŸ”¥ FIRE</button>
</div>

<script>
/* ================= SETUP ================= */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=canvas.offsetWidth;
  canvas.height=canvas.offsetHeight;
}
window.addEventListener("resize",resize);
resize();

/* ================= GAME STATE ================= */
let started=false,over=false;
let score=0,level=1,frame=0;
let pipeSpeed=2;

/* ================= BIRD ================= */
const birdImg=new Image();
const bird={
  x:80,y:200,w:40,h:40,vy:0,
  gravity:0.6,jump:-10,
  flap(){this.vy=this.jump},
  update(){
    this.vy+=this.gravity;
    this.y+=this.vy;
    if(this.y+this.h>canvas.height-80) over=true;
  },
  draw(){
    if(birdImg.src) ctx.drawImage(birdImg,this.x,this.y,this.w,this.h);
    else{
      ctx.fillStyle="red";
      ctx.fillRect(this.x,this.y,this.w,this.h);
    }
  }
};

/* ================= CLOUDS ================= */
const clouds=[...Array(5)].map(()=>({
  x:Math.random()*canvas.width,
  y:Math.random()*150,
  r:20+Math.random()*20
}));

function drawClouds(){
  ctx.fillStyle="white";
  clouds.forEach(c=>{
    c.x-=0.3;
    if(c.x<-50)c.x=canvas.width+50;
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
    ctx.arc(c.x+20,c.y+10,c.r,0,Math.PI*2);
    ctx.arc(c.x-20,c.y+10,c.r,0,Math.PI*2);
    ctx.fill();
  });
}

/* ================= GROUND ================= */
function drawGround(){
  ctx.fillStyle="#16a34a";
  ctx.fillRect(0,canvas.height-80,canvas.width,80);
}

/* ================= PIPES ================= */
const pipes=[];
function addPipe(){
  let top=60+Math.random()*200;
  pipes.push({x:canvas.width,top,scored:false});
}
function updatePipes(){
  if(frame%120===0)addPipe();
  pipes.forEach(p=>{
    p.x-=pipeSpeed;
    if(
      bird.x<p.x+60&&bird.x+bird.w>p.x&&
      (bird.y<p.top||bird.y+bird.h>p.top+150)
    ) over=true;

    if(!p.scored&&p.x+60<bird.x){
      score++;p.scored=true;
      if(score%5===0){level++;pipeSpeed+=0.4}
      updateHUD();
    }
  });
}
function drawPipes(){
  ctx.fillStyle="#15803d";
  pipes.forEach(p=>{
    ctx.fillRect(p.x,0,60,p.top);
    ctx.fillRect(p.x,p.top+150,60,canvas.height);
  });
}

/* ================= COMBAT ================= */
const bullets=[],enemies=[];

function shoot(){
  if(!started||over)return;
  bullets.push({x:bird.x+bird.w,y:bird.y+bird.h/2,w:12,h:4});
}

function spawnEnemy(){
  enemies.push({
    x:canvas.width+40,
    y:80+Math.random()*(canvas.height-200),
    alive:true,boom:0
  });
}

function updateCombat(){
  if(frame%180===0)spawnEnemy();

  bullets.forEach(b=>b.x+=6);
  enemies.forEach(e=>{
    if(e.alive)e.x-=2+level*0.3;
    else e.boom++;
  });

  bullets.forEach(b=>{
    enemies.forEach(e=>{
      if(e.alive&&
         b.x<e.x+40&&b.x+b.w>e.x&&
         b.y<e.y+40&&b.y+b.h>e.y){
        e.alive=false;
        score+=2;
        updateHUD();
      }
    });
  });
}

function drawCombat(){
  bullets.forEach(b=>{
    ctx.fillStyle="yellow";
    ctx.fillRect(b.x,b.y,b.w,b.h);
  });

  enemies.forEach(e=>{
    if(e.alive){
      ctx.fillStyle="#7c3aed";
      ctx.fillRect(e.x,e.y,40,40);
    }else{
      ctx.fillStyle=`rgba(255,150,0,${1-e.boom/10})`;
      ctx.beginPath();
      ctx.arc(e.x+20,e.y+20,e.boom*4,0,Math.PI*2);
      ctx.fill();
    }
  });
}

/* ================= INPUT ================= */
document.addEventListener("keydown",e=>{
  if(e.code==="Space")bird.flap();
  if(e.code==="KeyF")shoot();
});
canvas.addEventListener("mousedown",()=>bird.flap());
canvas.addEventListener("touchstart",e=>{
  if(e.touches.length===1)bird.flap();
  if(e.touches.length===2)shoot();
},{passive:false});

/* ================= UI ================= */
const startBtn=document.getElementById("startBtn");
const restartBtn=document.getElementById("restartBtn");
document.getElementById("shootBtn").onclick=shoot;

startBtn.onclick=()=>{
  started=true;over=false;
  startBtn.style.display="none";
};
restartBtn.onclick=reset;

document.getElementById("imageInput").onchange=e=>{
  const r=new FileReader();
  r.onload=ev=>birdImg.src=ev.target.result;
  r.readAsDataURL(e.target.files[0]);
};

function updateHUD(){
  scoreEl.textContent="Score: "+score;
  levelEl.textContent="Level: "+level;
}
const scoreEl=document.getElementById("score");
const levelEl=document.getElementById("level");

/* ================= RESET ================= */
function reset(){
  score=0;level=1;frame=0;pipeSpeed=2;
  pipes.length=bullets.length=enemies.length=0;
  bird.y=200;bird.vy=0;
  over=false;restartBtn.style.display="none";
  updateHUD();
}

/* ================= LOOP ================= */
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawClouds();

  if(started&&!over){
    frame++;
    bird.update();
    updatePipes();
    updateCombat();
  }

  drawPipes();
  drawCombat();
  bird.draw();
  drawGround();

  if(over){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#fff";
    ctx.font="28px Arial";
    ctx.textAlign="center";
    ctx.fillText("GAME OVER",canvas.width/2,canvas.height/2);
    restartBtn.style.display="block";
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
